

# ------------------------------------------------------------------------
# OWASP ModSecurity Core Rule Set ver.3.0.0
# Copyright (c) 2006-2016 Trustwave and contributors. All rights reserved.
#
# The OWASP ModSecurity Core Rule Set is distributed under
# Apache Software License (ASL) version 2
# Please see the enclosed LICENSE file for full details.
# ------------------------------------------------------------------------

# These exclusions remedy false positives in a default Drupal install.
# The exclusions are only active if crs_exclusions_drupal=1 is set.
# See rule 900130 in crs-setup.conf.example for instructions.

# FIXME: Policy / Rule Exclusion Strategy
# Tuning for PL1 and PL2



SecRule &TX:crs_exclusions_drupal|TX:crs_exclusions_drupal "@eq 0" \
	"id:9001000,\
	phase:2,\
	t:none,\
	nolog,\
	pass,\
	skipAfter:END-WORDPRESS"


#
# -=[ WordPress Front-End ]=-
#

#
# [ Login form ]
#

# User login password
SecRule REQUEST_FILENAME "@endsWith /user/login" \
	"id:9001100,\
	phase:2,\
	t:none,\
	nolog,\
	pass,\
	ctl:ruleRemoveTargetByTag=CRS;ARGS:pass"


# Install 
SecRule REQUEST_FILENAME "@endsWith /core/install.php" \
	"id:9001130,\
	phase:2,\
	nolog,\
	pass,\
	ctl:ruleRemoveTargetByTag=CRS;ARGS:account[pass][pass1],\
	ctl:ruleRemoveTargetByTag=CRS;ARGS:account[pass][pass2]"

# disable classes of attacks for title and article body
#ctl:ruleRemoveTargetByTag=attack-sqli;ARGS:post_title,\
#ctl:ruleRemoveTargetByTag=CRS;ARGS:content"

SecRule REQUEST_FILENAME "@endsWith /node/add/article" \
	"id:9001140,\
	phase:2,\
	nolog,\
	pass,\
	ctl:ruleRemoveTargetByTag=CRS;ARGS:body[0][value],\
	ctl:ruleRemoveTargetByTag=CRS;ARGS:uid[0][target_id]"


SecRule REQUEST_FILENAME "@endsWith /node/add/page" \
	"id:9001145,\
	phase:2,\
	nolog,\
	pass,\
	ctl:ruleRemoveTargetByTag=CRS;ARGS:body[0][value],\
	ctl:ruleRemoveTargetByTag=CRS;ARGS:uid[0][target_id]"



SecRule REQUEST_FILENAME "@endsWith /node/[0-9]+/edit" \
	"id:9001150,\
	phase:2,\
	nolog,\
	pass,\
	ctl:ruleRemoveTargetByTag=CRS;ARGS:body[0][value]"

# contextual render
# 942130 SQL Injection Attack: SQL Tautology Detected.
SecRule REQUEST_FILENAME "@endsWith /contextual/render" \
	"id:9001160,\
	phase:2,\
	nolog,\
	pass,\
	ctl:ruleRemoveTargetById=942130;ARGS:ids[]"




# Skip this section for performance unless /admin/ is in filename
SecRule REQUEST_FILENAME "!@contains /admin/" \
	"id:9001400,\
	phase:2,\
	t:none,\
	nolog,\
	pass,\
	skipAfter:END-DRUPAL-ADMIN"

#paranoia-level/1 930120 OS File Access Attempt
#paranoia-level/1 932160 Remote Command Execution: Unix Shell Code Found
#paranoia-level/1 941320 Possible XSS Attack Detected - HTML Tag Handler
#paranoia-level/1 942200 Detects MySQL comment-/space-obfuscated injections and backtick termination
#paranoia-level/1 942260 Detects basic SQL authentication bypass attempts 2/3
#paranoia-level/1 942370 Detects classic SQL injection probings 2/2
#paranoia-level/1 942430 Restricted SQL Character Anomaly Detection (args): # of special characters exceeded (12)
#paranoia-level/1 980110 Correlated Attack Attempt Identified: (Total ...) ...
#paranoia-level/2 920271 Invalid character in request (non printable characters)
#paranoia-level/2 942130 Possible XSS Attack Detected - HTML Tag Handler
#paranoia-level/2 942410 SQL Injection Attack
#paranoia-level/2 942440 SQL Comment Sequence Detected

# mkdir drupal-8.1.10/sites/default/files
# sudo chown www-data:www-data drupal-8.1.10/sites/default/files
# cp drupal-8.1.10/sites/default/default.settings.php  drupal-8.1.10/sites/default/settings.php
# sudo chown www-data:www-data drupal-8.1.10/sites/default/settings.php


SecMarker END-DRUPAL-ADMIN

SecMarker END-DRUPAL
